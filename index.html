<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CDS-Cluster-Lite</title>
    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
      
  </head>
  <body id="Body">
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", InitializeApplication, false );
    
    let G_Client = undefined;
    let applicationInitializedEvent    = new Event("applicationinitialized");
    document.addEventListener("applicationinitialized", StartApplication, false );
    
    
    function InitializeApplication(event) {
      event.preventDefault();
      event.stopPropagation();
      document.removeEventListener("DOMContentLoaded", InitializeApplication, false );
      console.log("Here 0");
      FHIR.oauth2.ready()
      .then(client => {console.log("Here 1"); client.request(`Patient/${client.patient.id}`)})
      .then(data => {console.log("Here 2"); console.log(data);})
      .catch(err => {console.log("Here 3"); console.error(err)});
      /*
      client = await FHIR.oauth2.ready();
      if(!client) {
        console.log("Error: No Client");
        return;
      }
      document.dispatchEvent(applicationInitializedEvent);
      */
      return;
    }
    function StartApplication(event) {
      event.preventDefault();
      event.stopPropagation();
      document.removeEventListener("applicationinitialized", StartApplication, false );
      /*
      let info = await client.request(`Patient/${client.patient.id}`);
      if(!info) {
        console.log("Error: No Patient Data");
        return;
      }
      let element = document.getElementById("Body");
      element.innerText = JSON.stringify(info);
      return;
      */
    }

  </script>
</html>
